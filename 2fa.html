<html>
<head>
<title>Auth0 - VoiceIt demo</title>
</head>

<body>

<h1>Auth0 - VoiceIt demo</h1>


<script src="./vendor/voiceit2.min.js"></script>
<script>
const ENDPOINT = "https://wt-13aebf4eeaa9913542725d4a90e4d49e-0.sandbox.auth0-extend.com/voiceit/voiceit_endpoint";
const TOKEN = "https://wt-13aebf4eeaa9913542725d4a90e4d49e-0.sandbox.auth0-extend.com/voiceit/voiceit_token";
const AUTH0_URL = "https://auth0-voiceit.auth0.com";

let queryParams = {};
location.href.substr(location.href.indexOf("?") + 1).split("&").map(i => {
  let el = i.split("=");
  queryParams[el[0]] = el[1];
});
auth0State = queryParams.state;

let myVoiceIt = new VoiceIt2.initialize(ENDPOINT, "./vendor/face_detector.wasm");

fetch(TOKEN).then(resp => resp.json()).then(data => {
  console.log(data);
  myVoiceIt.setSecureToken(data.Token);

  myVoiceIt.encapsulatedFaceVerification({
    // Set to true to present user with liveness challenges
    doLiveness:false,
    completionCallback:function(success){
      if(success){
        // Successfully verified user, now user can
        // be redirected to a protected page
        // Note: In addition to successfully verifying the user on
        // the frontend make sure to also check the json response on
        // the backend and successfully verify on the backend for true security.
        alert('Successfully verified face');
      } else {
        alert('Face Verification Cancelled or Failed!');

        //Redirect to Auth0
        location.replace(`${AUTH0_URL}/continue?state=${auth0State}`);
      }
    }
  });
});

</script>

</body>
</html>
